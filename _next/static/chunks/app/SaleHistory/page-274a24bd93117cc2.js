(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[932],{285:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var s=r(5155);r(2115);var a=r(9708),n=r(2085),i=r(9434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:r,size:n,asChild:l=!1,...o}=e,c=l?a.DX:"button";return(0,s.jsx)(c,{"data-slot":"button",className:(0,i.cn)(d({variant:r,size:n,className:t})),...o})}},2383:()=>{},3686:()=>{},4210:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(5155),a=r(285);let n=e=>{let{onExport:t,onClear:r}=e;return(0,s.jsxs)("div",{className:"flex justify-between items-center ",children:[(0,s.jsx)(a.$,{variant:"default",className:"bg-green-500 hover:bg-green-600",onClick:t,children:"エクセルに出力"}),(0,s.jsx)(a.$,{variant:"default",className:"bg-black",onClick:r,children:"履歴を全削除"})]})};function i(e){let{sale:t,index:r,menus:n,onRefund:i}=e;return(0,s.jsxs)("tr",{className:t.refunded?"bg-gray-400":"",children:[(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:r+1}),(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:new Date(t.timestamp).toLocaleString()}),(0,s.jsxs)("td",{className:"border px-2 py-1 text-center",children:["\xa5",t.total]}),n.map(e=>{let r=t.items.find(t=>t.id===e.id);return(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:r?r.quantity:""},e.id)}),(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:t.refunded?"済":""}),(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:!t.refunded&&(0,s.jsx)(a.$,{variant:"destructive",onClick:()=>i(r),className:"text-xs px-2 py-1",children:"払い戻し"})})]},r)}function d(e){let{totalAmount:t,allMenus:r,subtotalMap:a}=e;return(0,s.jsxs)("tr",{className:"bg-yellow-100 font-semibold",children:[(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:"小計"}),(0,s.jsx)("td",{className:"border px-2 py-1 text-center",colSpan:1}),(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:t}),r.map(e=>(0,s.jsx)("td",{className:"border px-2 py-1 text-center",children:a[e.id]||""},e.id)),(0,s.jsx)("td",{className:"border px-2 py-1 text-center",colSpan:2})]})}function l(e){let{sales:t,allMenus:r,onRefund:a}=e,n={},l=0;return r.forEach(e=>n[e.id]=0),t.forEach(e=>{e.refunded||(l+=e.total,e.items.forEach(e=>{n[e.id]+=e.quantity}))}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full table-auto border border-gray-300",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-100 text-sm",children:[(0,s.jsx)("th",{className:"border px-2 py-1",children:"No"}),(0,s.jsx)("th",{className:"border px-2 py-1",children:"日時"}),(0,s.jsx)("th",{className:"border px-2 py-1",children:"合計"}),r.map(e=>(0,s.jsx)("th",{className:"border px-2 py-1",children:e.name},e.id)),(0,s.jsx)("th",{className:"border px-2 py-1",children:"払い戻し"}),(0,s.jsx)("th",{className:"border px-2 py-1",children:"操作"})]})}),(0,s.jsxs)("tbody",{children:[[...t].slice().reverse().map((e,n)=>(0,s.jsx)(i,{sale:e,index:t.length-1-n,menus:r,onRefund:a},n)),(0,s.jsx)(d,{totalAmount:l,allMenus:r,subtotalMap:n})]})]})})}var o=r(2115),c=r(3925);function u(){let[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)([]);return(0,o.useEffect)(()=>{let e=localStorage.getItem("salesHistory"),r=localStorage.getItem("menus");e&&t(JSON.parse(e)),r&&a(JSON.parse(r))},[]),(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"会計履歴"}),(0,s.jsx)(n,{onExport:()=>{let t=["No","日時","合計",...r.map(e=>e.name)],s={No:"メニュー価格",日時:"",合計:""};r.forEach(e=>{var t;s[e.name]=null!=(t=e.price)?t:""});let a=e.filter(e=>!e.refunded),n=a.map((e,t)=>{let s={No:a.length-t,日時:e.timestamp,合計:e.total};return r.forEach(t=>{let r=e.items.find(e=>e.id===t.id);s[t.name]=r?r.quantity:""}),s}),i={No:"小計",日時:"",合計:""};r.forEach(e=>{i[e.name]=a.reduce((t,r)=>{let s=r.items.find(t=>t.id===e.id);return t+((null==s?void 0:s.quantity)||0)},0)});let d=[s,i,...n],l=c.Wp.json_to_sheet(d,{header:t}),o=c.Wp.book_new();c.Wp.book_append_sheet(o,l,"会計履歴"),c._h(o,"会計履歴.xlsx")},onClear:()=>{window.confirm("会計履歴をすべて削除しますか？　この操作は取り消せません")&&(localStorage.removeItem("salesHistory"),t([]),window.confirm("会計履歴を削除しました"))}}),0===e.length?(0,s.jsx)("p",{children:"会計履歴がありません。"}):(0,s.jsx)(l,{sales:e,allMenus:r,onRefund:r=>{if(!window.confirm("この会計を払い戻ししますか？"))return;let s=e[r],a=JSON.parse(localStorage.getItem("menus")||"[]").map(e=>{let t=s.items.find(t=>t.id===e.id);if(t){var r;return{...e,stock:Number(null!=(r=e.stock)?r:0)+t.quantity}}return e});localStorage.setItem("menus",JSON.stringify(a));let n=[...e];n[r].refunded=!0,localStorage.setItem("salesHistory",JSON.stringify(n)),t(n)}})]})}},7418:(e,t,r)=>{Promise.resolve().then(r.bind(r,4210))},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var s=r(2596),a=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[524,352,441,684,358],()=>t(7418)),_N_E=e.O()}]);