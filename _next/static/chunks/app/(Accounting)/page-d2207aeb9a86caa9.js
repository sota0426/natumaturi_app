(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[899],{115:(e,t,r)=>{"use strict";r.d(t,{M:()=>a});var s=r(2115);let a=()=>{let[e,t]=(0,s.useState)([]),[r,a]=(0,s.useState)([]),[l,i]=(0,s.useState)(!1);(0,s.useEffect)(()=>{try{let e=localStorage.getItem("categories"),r=localStorage.getItem("menus");if(e){let r=JSON.parse(e);t(Array.isArray(r)?r:[])}if(r){let e=JSON.parse(r);a(Array.isArray(e)?e:[])}}catch(e){console.error("Error loading data from localStorage:",e),t([]),a([])}finally{i(!0)}},[]);let n=(e,r)=>{try{localStorage.setItem("categories",JSON.stringify(e||[])),localStorage.setItem("menus",JSON.stringify(r||[])),t(Array.isArray(e)?e:[]),a(Array.isArray(r)?r:[])}catch(e){console.error("Error saving to localStorage:",e)}};return{categories:Array.isArray(e)?e:[],menus:Array.isArray(r)?r:[],isLoaded:l,setCategories:t,setMenus:a,saveToLocalStorage:n,addMenu:t=>{if(!t||!t.name||void 0===t.price)return void console.error("Invalid menu data for adding:",t);n(e,[...Array.isArray(r)?r:[],{...t,id:t.id||Date.now()+Math.random()}])},updateMenu:t=>{if(!t||void 0===t.id)return void console.error("Invalid menu data:",t);n(e,(Array.isArray(r)?r:[]).map(e=>e.id===t.id?{...e,...t}:e))},deleteMenu:t=>{if(null==t)return void console.error("Invalid menu ID for deletion:",t);n(e,(Array.isArray(r)?r:[]).filter(e=>e.id!==t))},addCategory:t=>{n([...Array.isArray(e)?e:[],t],r)},updateCategory:t=>{n((Array.isArray(e)?e:[]).map(e=>e.id===t.id?t:e),r)},deleteCategory:t=>{let s=Array.isArray(e)?e:[],a=Array.isArray(r)?r:[];n(s.filter(e=>e.id!==t),a.filter(e=>e.categoryId!==t))}}}},6367:(e,t,r)=>{Promise.resolve().then(r.bind(r,7811))},6748:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>n,_:()=>d});var s=r(5155),a=r(2115),l=r(115);let i=(0,a.createContext)(void 0),n=e=>{let{children:t}=e,[r,n]=(0,a.useState)([]),[d,o]=(0,a.useState)(!1),{menus:c,categories:x,saveToLocalStorage:m}=(0,l.M)(),[u,g]=(0,a.useState)(0);return(0,s.jsx)(i.Provider,{value:{cartItems:r,isOrderCompleted:d,orderSubmit:e=>{g(e);try{let e=c.map(e=>{let t=r.find(t=>t.id===e.id);if(t){var s;return{...e,stock:(null!=(s=e.stock)?s:0)-(null==t?void 0:t.quantity)}}return e}),t=[...JSON.parse(localStorage.getItem("salesHistory")||"[]"),{timestamp:new Date().toISOString(),items:r,total:r.reduce((e,t)=>e+t.price*t.quantity,0),refunded:!1}];localStorage.setItem("salesHistory",JSON.stringify(t)),m(x,e),o(!0)}catch(e){console.error("注文時にエラーが発生しました",e)}},proceedToNextOrder:()=>{n([]),o(!1)},addToCart:e=>{n(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},removeFromCart:e=>{n(t=>t.map(t=>t.id===e?{...t,quantity:t.quantity-1}:t).filter(e=>e.quantity>0))},receivedAmount:u,clearCart:()=>{window.confirm("カートを空にしますか？")&&(n([]),o(!1),g(0))}},children:t})},d=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useCart must be used within a CartProvider");return e}},7811:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),a=r(2115),l=r(115),i=r(6748);let n=e=>{let{category:t,onCollectSoldOutMenus:r}=e,{menus:n}=(0,l.M)(),{addToCart:d,removeFromCart:o,cartItems:c}=(0,i._)(),[x,m]=(0,a.useState)({});(0,a.useEffect)(()=>{if(Array.isArray(n)){let e={};n.forEach(t=>{e[t.id]="number"==typeof t.stock?t.stock:0}),m(e)}},[n]);let u={};c.forEach(e=>{u[e.id]=(u[e.id]||0)+1});let g=(Array.isArray(n)?n:[]).filter(e=>e.categoryId===t.id),h=g.map(e=>{var t,r;return{...e,stock:null!=(t=x[e.id])?t:e.stock,cartCount:null!=(r=u[e.id])?r:0}}),b=h.filter(e=>0===e.stock&&0===e.cartCount),y=h.filter(e=>0!==e.stock||0!==e.cartCount),p=(0,a.useRef)(""),f=(0,a.useRef)(void 0);(0,a.useEffect)(()=>{if(!r)return;f.current=r;let e=b.map(e=>e.id).join(",");e!==p.current&&(p.current=e,r(b))},[b,r]);let j=e=>{var t;let r=null!=(t=x[e])?t:0;if(r>0){m(t=>({...t,[e]:r-1}));let t=g.find(t=>t.id===e);t&&d(t)}},v=e=>{var t;(null!=(t=u[e])?t:0)>0&&(m(t=>{var r;return{...t,[e]:(null!=(r=t[e])?r:0)+1}}),o(e))};return 0===y.length?null:(0,s.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-5 mb-6 shadow-sm",children:[(0,s.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-3",children:[(0,s.jsx)("span",{className:"bg-blue-100 text-blue-700 rounded-full w-7 h-7 flex items-center justify-center text-sm font-semibold",children:"\uD83C\uDF7D"}),t.id," ---- ",t.name," ----",(0,s.jsxs)("span",{className:"text-sm text-gray-500 ml-auto",children:[y.length," 件のメニュー"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:y.map(e=>(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg px-4 py-4 hover:bg-gray-50 hover:shadow-sm transition-all duration-200",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("span",{className:"text-gray-800 font-semibold text-lg block truncate",children:[e.id," : ",e.name]})}),(0,s.jsxs)("div",{className:"flex items-center gap-6 flex-shrink-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,s.jsx)("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full whitespace-nowrap",children:"価格"}),(0,s.jsxs)("span",{className:"text-green-700 font-bold text-lg whitespace-nowrap",children:["\xa5",e.price.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,s.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full whitespace-nowrap ".concat(e.stock>10?"bg-blue-100 text-blue-800":e.stock>5?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"在庫"}),(0,s.jsxs)("span",{className:"font-bold text-lg whitespace-nowrap ".concat(e.stock>10?"text-blue-700":e.stock>5?"text-yellow-700":"text-red-700"),children:[e.stock,"個"]})]}),(0,s.jsxs)("div",{className:"flex gap-3 text-sm",children:[(0,s.jsx)("button",{onClick:()=>j(e.id),disabled:0===e.stock,className:"px-3 py-2 font-medium rounded-lg transition-colors duration-200 border whitespace-nowrap ".concat(0===e.stock?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-blue-50 text-green-600 hover:bg-blue-100 hover:text-green-800 border-blue-200"),children:"+1"}),(0,s.jsx)("button",{onClick:()=>v(e.id),disabled:0===e.cartCount,className:"px-3 py-2 font-medium rounded-lg transition-colors duration-200 border whitespace-nowrap ".concat(0===e.cartCount?"bg-gray-100 text-gray-400 border-gray-200 cursor-not-allowed":"bg-red-50 text-red-600 hover:bg-red-100 hover:text-red-800 border-red-200"),children:"-1"})]})]})]})},e.id))})]})},d=()=>{let[e,t]=(0,a.useState)(!1),[r,i]=(0,a.useState)([]),{categories:d,menus:o}=(0,l.M)(),c=e=>{i(t=>{let r=new Set(t.map(e=>e.id));return[...t,...e.filter(e=>!r.has(e.id))]})},x=d.filter(t=>o.filter(r=>r.categoryId===t.id&&(!e||r.stock>0)).length>0);return(0,s.jsxs)("div",{className:"menu-screen px-4 py-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"【注文メニュー】"}),(0,s.jsx)("button",{onClick:()=>{t(!e)},className:"mb-6 px-4 py-2 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 transition",children:e?"すべて表示":"売り切れ商品を非表示"}),!e&&r.length>0&&(0,s.jsxs)("div",{className:"mb-10 border-t pt-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-700 mb-4",children:"売り切れ商品"}),(0,s.jsx)("div",{className:"space-y-2 opacity-60 mb-6",children:r.map(e=>(0,s.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-gray-700 font-medium truncate",children:[e.id," : ",e.name]}),(0,s.jsx)("span",{className:"text-red-600 font-semibold",children:"売り切れ"})]},e.id))})]}),x.map(e=>(0,s.jsx)(n,{category:e,onCollectSoldOutMenus:c},e.id))]})},o=e=>{let{total:t}=e,[r,l]=(0,a.useState)(0),{clearCart:n,orderSubmit:d}=(0,i._)(),o=r-t,c=e=>{l(t=>10*t+e)},x=()=>{l(0)};return(0,s.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,s.jsxs)("div",{className:"text-right font-bold text-3xl text-gray-800 mb-4",children:["合計: \xa5",t.toLocaleString()]}),(0,s.jsxs)("div",{className:"mb-4 text-gray-700 font-mesium text-2xl",children:["預り金：￥",r.toLocaleString()]}),(0,s.jsxs)("div",{className:"text-gray-800 mb-4 text-2xl",children:["おつり：",(0,s.jsx)("span",{className:"font-bold text-green-700",children:o>=0?"￥".concat(o.toLocaleString()):"不足しています"})]}),(0,s.jsxs)("div",{className:"mt-20 grid grid-cols-3 gap-2 mb-4",children:[[7,8,9,4,5,6,1,2,3].map((e,t)=>(0,s.jsx)("button",{onClick:()=>c(e),className:"py-2 bg-gray-200 hover:bg-gray-300 rounded text-lg",children:e},t)),(0,s.jsx)("button",{className:"py-2 bg-gray-200 hover:bg-gray-300 rounded text-lg",onClick:()=>{c(0),c(0)},children:"00"}),(0,s.jsx)("button",{className:"py-2 bg-gray-200 hover:bg-gray-300 rounded text-lg",onClick:()=>c(0),children:"0"}),(0,s.jsx)("button",{className:"py-2  bg-gray-200 hover:bg-gray-300 rounded text-lg ",onClick:()=>x(),children:"Clear"})]}),(0,s.jsx)("div",{className:"flex justify-between",children:(0,s.jsx)("button",{onClick:()=>{d(r),x()},disabled:0===t||o<0,className:"px-4 py-2 rounded text-white transition ".concat(t>0&&o>=0?"bg-red-500 hover:bg-red-600":"bg-gray-400 cursor-not-allowed"),children:"注文完了"})}),(0,s.jsx)("button",{onClick:()=>{n(),x()},className:"text-right mt-4 px-4 py-2 bg-green-700 text-white rounded hover:bg-green-600 transition",disabled:0===t,children:"カートを空にする"})]})},c=()=>{let{cartItems:e,proceedToNextOrder:t,receivedAmount:r}=(0,i._)(),a=e.reduce((e,t)=>e+t.price*t.quantity,0),l=r-a;return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsx)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"✅"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-green-600 mb-2",children:"注文完了"}),(0,s.jsx)("p",{className:"text-gray-600",children:"ご注文ありがとうございました"})]}),(0,s.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-semibold mb-3",children:"注文内容"}),(0,s.jsx)("div",{className:"space-y-2 text-sm",children:e.map(e=>(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:[e.name," \xd7 ",e.quantity]}),(0,s.jsxs)("span",{children:["￥",(e.price*e.quantity).toLocaleString()]})]},e.id))}),(0,s.jsxs)("div",{className:"border-t pt-2 mt-2 space-y-1 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between font-bold",children:[(0,s.jsx)("span",{children:"合計"}),(0,s.jsxs)("span",{children:["￥",a.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"預り金"}),(0,s.jsxs)("span",{children:["￥",r.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:"おつり"}),(0,s.jsxs)("span",{children:["￥",l>=0?l.toLocaleString():"0"]})]})]})]}),(0,s.jsx)("button",{onClick:t,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium",children:"次の注文に進む"})]})})})},x=()=>{let{cartItems:e,isOrderCompleted:t}=(0,i._)(),r=e.reduce((e,t)=>e+t.price*t.quantity,0);return(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg border shadow-md",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"\uD83D\uDED2 購入カート"}),0===e.length?(0,s.jsx)("p",{className:"text-gray-500",children:"カートは空です。"}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("ul",{className:"space-y-3 mb-4",children:e.map(e=>(0,s.jsxs)("li",{className:"flex justify-between items-center text-2xl",children:[(0,s.jsxs)("span",{className:"text-gray-800",children:[e.name," \xd7 ",e.quantity]}),(0,s.jsxs)("span",{className:"text-green-700 font-semibold",children:["\xa5",(e.price*e.quantity).toLocaleString()]})]},e.id))})}),(0,s.jsx)(o,{total:r}),t&&(0,s.jsx)(c,{})]})},m=()=>(0,s.jsxs)("div",{className:"min-h-screen p-4 flex flex-col lg:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1 min-h-[300px] overflow-visible",children:(0,s.jsx)(d,{})}),(0,s.jsx)("div",{className:"w-full lg:w-[400px] shrink-0 overflow-visible",children:(0,s.jsx)(x,{})})]})}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(6367)),_N_E=e.O()}]);